# %%
import numpy as np
import matplotlib.pyplot as plt
import pandas as pd


# %%
pmf_diffs = [
    -0.0652774741607357,
    -0.23445339595697223,
    0.22489020914300561,
    -0.16870096529926903,
    -0.047543230548993676,
    -0.12052481520671254,
    -0.11270410270494313,
    -0.04699043643184819,
    -0.29708909337221046,
    -0.3102954684036612,
    -0.10543126162891958,
    0.005927592962882811,
    -0.10843231013071197,
    0.05944438502090721,
    -0.04689627470498503,
    -0.05704603430186328,
    -0.3208488627373054,
    0.2697601357595125,
    -0.014585095935481407,
    -0.18480922627763485,
    0.033154311295792604,
    -0.16385712698374366,
    -0.011978617056655039,
    -0.11962706245414967,
    -0.060770424849893145,
    -0.1716076395021192,
    -0.049007141913044894,
    -0.041592003111535214,
    -0.0881281545393815,
    -0.028518769708738456,
    0.829900274209761,
    -0.07362461041402035,
    -0.0383593690908296,
    -0.12771756000154433,
    -0.14501581388113371,
    -0.09252870082015363,
    -0.2834922976005021,
    0.17101204523202607,
    -0.1177767252999733,
    -0.15935323644368704,
    -0.1856566021525855,
    -0.17697246554139123,
    -0.06848055295840683,
    -0.12149921921289852,
    -0.16834848970601768,
    -0.024832763611707165,
    -0.06418251624943017,
    -0.03580493770063842,
    -0.032474755109471065,
    -0.19623614758842756,
    -0.16782329834875187,
    -0.17664374465214705,
    -0.05872662571729392,
    -0.08711661511846047,
    -0.12983617250568513,
    -0.05422321609755332,
    -0.0019171663039281306,
    0.33348594784183927,
    0.20943438697617256,
    -0.24134774145095572,
    0.13108541035610455,
    0.23161628766672115,
    -0.09624012909522672,
    0.08727911938973865,
    -0.19531611817565975,
    -0.2440368367314607,
    -0.2392585482188314,
    -0.11046871432033867,
    -0.25696167202821474,
    -0.19276135774416525,
    -0.39341595294816667,
    -0.2323777857369267,
    0.031018997046080576,
    -0.06797511936778933,
    0.013608162344331598,
    0.15493691247210784,
    -0.17763785402668064,
    -0.03130141175549128,
    -0.10635077927394243,
    -0.058814167600918066,
    0.47191237345171677,
    -0.02999790599880836,
    -0.19082690941808989,
    -0.19528640997867652,
    -0.32837922845150325,
    0.2893537714352745,
    -0.14388571855803678,
]

idx_names = [
    0,
    6,
    8,
    10,
    12,
    14,
    16,
    18,
    20,
    22,
    24,
    32,
    34,
    36,
    38,
    42,
    44,
    58,
    60,
    66,
    68,
    70,
    72,
    74,
    76,
    78,
    80,
    96,
    98,
    100,
    102,
    108,
    110,
    128,
    130,
    132,
    134,
    136,
    138,
    140,
    142,
    144,
    146,
    150,
    154,
    156,
    158,
    160,
    162,
    168,
    170,
    172,
    178,
    180,
    182,
    184,
    186,
    188,
    190,
    192,
    194,
    216,
    218,
    224,
    226,
    228,
    230,
    232,
    234,
    244,
    246,
    250,
    252,
    254,
    256,
    258,
    260,
    264,
    266,
    272,
    274,
    276,
    278,
    280,
    282,
    294,
    298,
]


# %%
np.argsort(pmf_diffs)  # [::-1]
# %%

# largest
selected_idxs = [30, 80, 57, 85, 17, 61, 2, 58, 37, 75]
# ~10-20% error
# selected_idxs = [37, 75, 60]

# smallest
selected_idxs = [
    70,
    84,
    16,
    9,
    8,
    36,
    68,
    65,
    59,
    66,
    1,
    71,
    49,
    64,
    83,
    69,
    82,
    40,
    19,
    76,
]

# smallest ten
selected_idxs = [70, 84, 16, 9, 8, 36, 68, 65, 59, 66]

# smallest error: between 10% to 25% smallest error
selected_idxs = [65, 59, 66, 1, 71, 49, 64, 83, 69, 82, 40, 19, 76]
# smaller subset of the above
# selected_idxs = [65, 59, 66,  1, 71, 49, 64]
selected_idxs = [
    65,
    59,
    66,
    1,
    71,
    49,
    64,
    83,
    69,
    82,
    40,
    19,
    76,
    41,
    51,
    25,
    3,
    44,
    50,
    21,
    39,
]

# selected_idxs = selected_idxs[:21]

print(selected_idxs)
print(len(selected_idxs))
idx_name = np.array(idx_names)[selected_idxs]
pmf_diff = np.array(pmf_diffs)[selected_idxs]


# %%
# smallest error: 10% - 25%

print(idx_name.tolist())
print(pmf_diff.tolist())
# print(np.argmin(np.abs(pmf_diff + 0.15)))
avg_err = np.abs(pmf_diff).mean() * 100.0
print(avg_err)

pmf_percent_diff = 100.0 * np.array(pmf_diff)
data = pd.DataFrame(pmf_percent_diff, index=idx_name, columns=["values"])
fig, (ax1) = plt.subplots(1, 1, sharex=True, figsize=(5.0, 3.0))

true_col = "g"
false_col = "r"

data["values"].plot(
    kind="bar",
    width=1.0,
    edgecolor="black",
    color=(data["values"] > 0).map({True: true_col, False: false_col}),
)

plt.grid()

plt.xlabel("grid idx")
plt.ylabel("percentage rel. pmf diff")

err_input = np.around(avg_err, 2)

title = ""

plt.title(title, fontsize=12, pad=-10)
plt.ylim([-100, 100])
plt.tight_layout()

plt.show()
# %%
